<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="James Hickey" />

<meta name="date" content="2024-01-21" />

<title>Guide to the Cox Proportional Hazards model</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Guide to the Cox Proportional Hazards
model</h1>
<h4 class="author">James Hickey</h4>
<h4 class="date">2024-01-21</h4>



<p><code>gbm</code> facilitates the creation of boosted Cox proportional
hazards models, a particularly useful feature when dealing with survival
data. The package can handle two types of survival object as the
response, namely a right censored or counting survival object. Both of
these objects can be created using the <code>Surv</code> command found
in the <code>survival</code> package.</p>
<div id="set-up-of-data-and-distribution-object" class="section level1">
<h1>Set-up of data and distribution object</h1>
<p>Right censored survival data consists of a time to event number and
the event indicator - 0 if no event has taken place and 1 if the event
has happened. On the other hand, counting survival data contains start
and stop times along with an event indicator again indicating if an
event has taken place in that period. The data may be organised into
strata and this should be passed to <code>gbm_dist</code> on creation of
the <code>CoxPHGBMDist</code> object - see the “Model Specific
Parameters” vignette for more details. The dataset considered here is
provided by the <code>survival</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## Install package</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">require</span>(survival)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># get datasets</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>right_cens <span class="ot">&lt;-</span> cgd[cgd<span class="sc">$</span>enum<span class="sc">==</span><span class="dv">1</span>, ]</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>start_stop <span class="ot">&lt;-</span> cgd</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co"># Set up GBMDist objects</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>right_cens_dist <span class="ot">&lt;-</span> <span class="fu">gbm_dist</span>(<span class="st">&quot;CoxPH&quot;</span>, <span class="at">strata=</span>right_cens<span class="sc">$</span>hos.cat)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>start_stop_dist <span class="ot">&lt;-</span> <span class="fu">gbm_dist</span>(<span class="st">&quot;CoxPH&quot;</span>, <span class="at">strata=</span>start_stop<span class="sc">$</span>hos.cat)</span></code></pre></div>
</div>
<div id="creating-a-boosted-model" class="section level1">
<h1>Creating a boosted model</h1>
<p>Now to create the underlying boosted model the training parameters
need to be defined and <code>gbmt</code> called. In this instance the
data has observation ids associated with it and so it is necessary to
create specific <code>GBMTrainParams</code> objects rather than relying
on the defaults.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Set-up training parameters</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>params_right_cens <span class="ot">&lt;-</span> <span class="fu">training_params</span>(<span class="at">num_trees =</span> <span class="dv">2000</span>, <span class="at">interaction_depth =</span> <span class="dv">3</span>, </span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>                                     <span class="at">id=</span>right_cens<span class="sc">$</span>id,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>                                     <span class="at">num_train=</span><span class="fu">round</span>(<span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">length</span>(<span class="fu">unique</span>(right_cens<span class="sc">$</span>id))) )</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>params_start_stop <span class="ot">&lt;-</span> <span class="fu">training_params</span>(<span class="at">num_trees =</span> <span class="dv">2000</span>, <span class="at">interaction_depth =</span> <span class="dv">3</span>, </span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>                                     <span class="at">id=</span>start_stop<span class="sc">$</span>id,</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>                                     <span class="at">num_train=</span><span class="fu">round</span>(<span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">length</span>(<span class="fu">unique</span>(start_stop<span class="sc">$</span>id))) )</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co"># Call to gbmt</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>fit_right_cens <span class="ot">&lt;-</span> <span class="fu">gbmt</span>(<span class="fu">Surv</span>(tstop, status)<span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> inherit <span class="sc">+</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>                     steroids <span class="sc">+</span> propylac, <span class="at">data=</span>right_cens, </span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>                     <span class="at">distribution =</span> right_cens_dist,</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>                     <span class="at">train_params =</span> params_right_cens, <span class="at">cv_folds=</span><span class="dv">10</span>,</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>                     <span class="at">keep_gbm_data =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>fit_start_stop <span class="ot">&lt;-</span> <span class="fu">gbmt</span>(<span class="fu">Surv</span>(tstart, tstop, status)<span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> inherit <span class="sc">+</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>                     steroids <span class="sc">+</span> propylac, <span class="at">data=</span>start_stop, </span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>                     <span class="at">distribution =</span> start_stop_dist,</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>                     <span class="at">train_params =</span> params_start_stop, <span class="at">cv_folds=</span><span class="dv">10</span>, </span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>                     <span class="at">keep_gbm_data =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co"># Plot performance</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>best_iter_right <span class="ot">&lt;-</span> <span class="fu">gbmt_performance</span>(fit_right_cens, <span class="at">method=</span><span class="st">&#39;test&#39;</span>)</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>best_iter_stop_start <span class="ot">&lt;-</span> <span class="fu">gbmt_performance</span>(fit_start_stop, <span class="at">method=</span><span class="st">&#39;test&#39;</span>)</span></code></pre></div>
</div>
<div id="strata-updates" class="section level1">
<h1>Strata Updates</h1>
<p>During the fitting process the original strata vector is updated in
the following way. When the data is split into a training and validation
set the strata vector is also split. The strata vector is then updated
so as represent the cumulative count of the number of observations in
each stratum in the training and validation sets. The vector is padded
with <code>NAs</code> so it is of the same length as the original strata
vector provided and such that the validation set cumulative strata sums
are separated from the training set strata counts by the appropriate
amount.</p>
<p>The original strata vector is stored within the <code>GBMFit</code>
object and can be accessed as follows:
<code>fit$distribution$original_strata_id</code>. The data in the
<code>original_strata_id</code> field is used to recreate the correct
strata when performing additional iterations using
<code>gbm_more</code>.</p>
</div>
<div id="role-of-additional-parameters-in-gbmdist" class="section level1">
<h1>Role of additional parameters in GBMDist</h1>
<div id="ties-and-prior_node_coeff_var" class="section level2">
<h2>ties and prior_node_coeff_var</h2>
<p>The <code>ties</code> and <code>prior_node_coeff_var</code>
parameters may also be specified on construction of the
<code>CoxPHGBMDist</code> object. The former is a string specifying the
method by which the algorithm deals with tied event times. This may be
set to either “breslow” or “efron” depending on your preference, with
the latter being the default. The role of the
<code>prior_node_coeff_var</code> parameter is slightly more subtle and
complex. When fitting a boosted tree, the optimal predictions of the
terminal nodes must be set. These predictions determine the predictions
made by the <code>GBMFit</code> object. The role of
<code>prior_node_coeff_var</code> is to ensure that the predictions are
finite and it does this by acting as a regularization for the terminal
node predictions. It should be a finite positive double and is by
default set to a 1000. An exact description of its role in the
underlying algorithm is described in the next section.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Example using Breslow and Efron tie-breaking</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co"># Create data</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">require</span>(survival)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">3000</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>X3 <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],N,<span class="at">replace=</span>T))</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>)[<span class="fu">as.numeric</span>(X3)]</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fu">sin</span>(<span class="dv">3</span><span class="sc">*</span>X1 <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>X2<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> mu<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>tt.surv <span class="ot">&lt;-</span> <span class="fu">rexp</span>(N,<span class="fu">exp</span>(f))</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>tt.cens <span class="ot">&lt;-</span> <span class="fu">rexp</span>(N,<span class="fl">0.5</span>)</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(tt.surv <span class="sc">&lt;=</span> tt.cens)</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>tt <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">cbind</span>(tt.surv,tt.cens),<span class="dv">1</span>,min)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co"># throw in some missing values</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>X1[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>N,<span class="at">size=</span><span class="dv">100</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>X3[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>N,<span class="at">size=</span><span class="dv">300</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co"># random weights if you want to experiment with them</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>,N)</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tt=</span>tt,<span class="at">delta=</span>delta,<span class="at">X1=</span>X1,<span class="at">X2=</span>X2,<span class="at">X3=</span>X3)</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co"># Set up distribution objects</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>cox_breslow <span class="ot">&lt;-</span> <span class="fu">gbm_dist</span>(<span class="st">&quot;CoxPH&quot;</span>, <span class="at">ties=</span><span class="st">&quot;breslow&quot;</span>, <span class="at">prior_node_coeff_var=</span><span class="dv">100</span>)</span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>cox_efron <span class="ot">&lt;-</span> <span class="fu">gbm_dist</span>(<span class="st">&quot;CoxPH&quot;</span>, <span class="at">ties=</span><span class="st">&quot;efron&quot;</span>, <span class="at">prior_node_coeff_var=</span><span class="dv">100</span>)</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co"># Define training parameters</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">training_params</span>(<span class="at">num_trees=</span><span class="dv">3000</span>, <span class="at">interaction_depth=</span><span class="dv">3</span>, <span class="at">min_num_obs_in_node=</span><span class="dv">10</span>, </span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>                          <span class="at">shrinkage=</span><span class="fl">0.001</span>, <span class="at">bag_fraction=</span><span class="fl">0.5</span>, <span class="at">id=</span><span class="fu">seq</span>(<span class="fu">nrow</span>(data)), </span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>                          <span class="at">num_train=</span>N<span class="sc">/</span><span class="dv">2</span>, <span class="at">num_features=</span><span class="dv">3</span>)</span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="co"># Fit gbm </span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>fit_breslow <span class="ot">&lt;-</span> <span class="fu">gbmt</span>(<span class="fu">Surv</span>(tt, delta)<span class="sc">~</span>X1<span class="sc">+</span>X2<span class="sc">+</span>X3, <span class="at">data=</span>data, <span class="at">distribution=</span>cox_breslow, </span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>                    <span class="at">weights=</span>w, <span class="at">train_params=</span>params, <span class="at">var_monotone=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>                    <span class="at">keep_gbm_data=</span><span class="cn">TRUE</span>, <span class="at">cv_folds=</span><span class="dv">5</span>, <span class="at">is_verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>fit_efron <span class="ot">&lt;-</span> <span class="fu">gbmt</span>(<span class="fu">Surv</span>(tt, delta)<span class="sc">~</span>X1<span class="sc">+</span>X2<span class="sc">+</span>X3, <span class="at">data=</span>data, <span class="at">distribution=</span>cox_efron,</span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>                  <span class="at">weights=</span>w, <span class="at">train_params=</span>params, <span class="at">var_monotone=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>                  <span class="at">keep_gbm_data=</span><span class="cn">TRUE</span>, <span class="at">cv_folds=</span><span class="dv">5</span>, <span class="at">is_verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a><span class="co"># Evaluate fit </span></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">gbmt_performance</span>(fit_breslow, <span class="at">method=</span><span class="st">&#39;test&#39;</span>))</span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;training error&quot;</span>, <span class="st">&quot;test error&quot;</span>, <span class="st">&quot;optimal iteration&quot;</span>),</span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a>       <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">gbmt_performance</span>(fit_efron, <span class="at">method=</span><span class="st">&#39;test&#39;</span>))</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;training error&quot;</span>, <span class="st">&quot;test error&quot;</span>, <span class="st">&quot;optimal iteration&quot;</span>),</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>       <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
</div>
<div id="description-of-the-underlying-algorithm---specifically-for-coxph" class="section level1">
<h1>Description of the underlying algorithm - specifically for
CoxPH</h1>
<p>The <code>gbm</code> algorithm works to estimate, via tree boosting,
the function <span class="math inline">\(f(\textbf{x})\)</span>, which
maps covariates (<span class="math inline">\(\textbf{x}\)</span>) to the
response variable <em>y</em> - in this case the event indicator. For
<code>CoxPH</code>, the algorithm calculates both the partial log
likelihood and martingale residuals (<span class="math inline">\(\textbf{m}\)</span>) using the following approach.
The algorithm walks backwards in time until it encounters the “stop”
time of an observation. When this happens the weighted risk associated
with that observation, <span class="math inline">\(\omega_i
e^{f(\textbf{x}_i)}\)</span>, is added to the total cumulative hazard:
<span class="math inline">\(S = \sum \omega_j
e^{f(\textbf{x}_j)}\)</span>, which is initialized at <span class="math inline">\(0\)</span>. Continuing backwards in time when we
reach a time before an observation was in the study, that is the
algorithm leaves the associated time segment (start, stop], the
observation’s contribution to the cumulative hazard is subtracted off.
The algorithm is robust to overflow/underflows occurring in <span class="math inline">\(e^{f(\textbf{x}_i)}\)</span> by subtracting a
constant off of the risk score. This constant drifts to ensure overflow
does not occur.</p>
<p>This algorithm deals with tied event times using either the Breslow
or Efron approximations. The method used is specified by the user but in
the event of tied deaths, it defaults to the Efron approximation. It
also allows for the introduction of strata and start as well as stop
times for each observation, see the previous Sections.</p>
<p>As well as calculating the partial log likelihood the algorithm also
calculates the martingale residuals. The risk scores are related to the
covariate matrix, <span class="math inline">\(\mathbb{X}\)</span>, via:
<span class="math display">\[ f(\textbf{x}_i) =
(\mathbb{X}\boldsymbol{\beta})_i.   \qquad (1) \]</span> The derivative
of the partial log likelihood, <span class="math inline">\(l(\boldsymbol{\beta})\)</span>, with respect to
the parameter vector <span class="math inline">\(\boldsymbol{\beta}\)</span> is related to the
martingale residuals through: <span class="math display">\[\frac{\partial}{\partial \boldsymbol{\beta}}
l(\boldsymbol{\beta}) = \mathbb{X}^{T} \textbf{m}.  \qquad (2) \]</span>
Defining the loss function as the negative of the partial log likelihood
then using the chain rule in combination with Equation (1) the residuals
are given by: <span class="math display">\[ z_i =
-\frac{\partial}{\partial
f(\textbf{x}_{\textit{i}})}\Psi(\textit{y}_{\textit{i}},f(\textbf{x}_\textit{i}))
= (\mathbb{X}\mathbb{X}^{T}\textbf{m})_i.  \qquad (3)\]</span></p>
<p>At this point the covariate matrix should only decide what splits the
tree will make thus covariate matrix in Equation (3) is free to be set
to the identity matrix and so: <span class="math display">\[ z_i =
\textbf{m}_i. \qquad (4)\]</span></p>
<p>Finally, the updated implementation calculates the optimal terminal
node predictions in the following way. Looping over the bagged
observations in the terminal node of interest the expected number of
events is given by: <span class="math inline">\(\sum_i \max(0.0, y_i -
\textbf{m}_i) + 1/c\)</span>. The constant <span class="math inline">\(c\)</span> represents the prior on the baseline
number of events that occur within a given terminal node; it can be set
on construction of the <code>CoxPHGBMDist</code> through the
<code>prior_node_coeff_var</code> parameter. From this the terminal node
prediction is given by: <span class="math display">\[ \log(\frac{\sum_i
y_i + 1/c}{\sum_i \max(0.0, y_i - \textbf{m}_i) + 1/c}). \qquad
(5)\]</span></p>
<p>If this <code>prior_node_coeff_var</code> is set incorrectly, i. e.
to not a finite positive double, then the predictions of the fitted
model can become non-sensical.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
